{% extends "./base.html" %} {% block content %} {% if user.is_authenticated %}

<br />
<h2 class="mt-5">Based on you interests</h2>
<div id="results" style="display: flex;flex-wrap: wrap;">
  {% for story in appuser.interests.first.category_stories.all %}
  <div class="card" style="width: 18rem; margin:10px;">
    <div class="card-body">
      <h5 class="card-title">{{story}}</h5>
      <p class="card-text">
      <p>{{story.description}}</p>
      </p>
    </div>
    <ul class="list-group list-group-flush">
      <li class="list-group-item">{{story.author.first_name}} {{story.author.last_name}}</li>
      <li class="list-group-item">{{story.created_on|date}}</li>
    </ul>
    <div class="card-body">
      <div class="alert alert-primary" role="alert">
        <p class="mb-0">{{story.category}}</p>
      </div>
      <a href="/story/{{story.pk}}">Read more</a>

    </div>
  </div>
  {% endfor %}
</div>


<br />
<h3>Leader board</h3>
<table class="table table-striped table-dark">
  <thead>
    <tr>
      <th scope="col">Badge</th>
      <th scope="col">Username</th>
      <th scope="col">Full name</th>
      <th scope="col">Points</th>
    </tr>
  </thead>
  <tbody>
    {% for appuserob in users_sorted %}
    <tr>
      {% if forloop.counter == 1 %}
      <th scope="row">ðŸ¥‡</th>
      {% elif forloop.counter == 2 %}
      <th scope="row">ðŸ¥ˆ</th>
      {% elif forloop.counter == 3 %}
      <th scope="row">ðŸ¥‰</th>
      {% else %}
      <th scope="row"> </th>
      {% endif %}


      <td>{{appuserob}}</td>
      <td>{{appuserob.user.first_name}} {{appuserob.user.last_name}}</td>
      <td># {{appuserob.upvote_sum}} </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<br />
<h3>Your overview</h3>
<div class="card" style="width: 18rem">
  <!-- <img class="card-img-top" src="..." alt="Card image cap" /> -->
  <div class="card-body">
    <h5 class="card-title">{{appuser.user.username}}</h5>
    <!-- <p class="card-text">
      Some quick example text to build on the card title and make up the bulk of
      the card's content.
    </p> -->
  </div>
  <ul class="list-group list-group-flush">
    <li class="list-group-item">{{appuser.user.first_name}}</li>
    <li class="list-group-item">{{appuser.user.last_name}}</li>
    <li class="list-group-item">{{appuser.organisation}}</li>
    <li class="list-group-item">{{appuser.user.date_joined}}</li>
  </ul>
  <div class="card-body">
    <div class="alert alert-primary" role="alert">
      <h4 class="alert-heading">Status</h4>
      <hr />
      <p class="mb-0">{{appuser.status}}</p>
    </div>
  </div>
</div>
<br />

<div id="images"></div>

<script>
  setInterval(function () {
    const req = new XMLHttpRequest();
    req.onreadystatechange = function () {
      if (req.readyState === 4) {
        html = "";
        // html = '<div class="image-grid container">';
        html = "<h3>Your images</h3>";

        data = JSON.parse(req.response);
        console.log(data.length);

        if (data.length > 0) {
          data.forEach(function (obj) {
            html +=
              '<div><img src="' + obj.thumbnail + '" class="item"> </div>';
          });
        } else {
          html +=
            "<div><p>You have no images yet. To add images go to <a href='/media'>Media</a>.</p></div>";
        }

        // html += "</div>";
        document.getElementById("images").innerHTML = html;
      }
    };
    req.open("GET", "/api/images/");
    req.send();
  }, 5000);
</script>

{% else %}
<p>
  You are not logged in, please register or log in. {% endif %} {% endblock %}
</p>