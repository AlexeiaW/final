{% extends "./base.html" %} {% block content %} {% if user.is_authenticated %}

<h3>Search for groups by name to add them.</h3>
<form id="search_form" class="form-inline" onsubmit="searchGroups(event)">
  {% csrf_token %} Group name:
  <input class="form-control" type="text" name="groupname" value="" placeholder="Leave empty to get all groups"
    size="50" />
  <button class="btn btn-primary" type="submit">Search</button>
</form>

<div id="results"></div>
{% else %}
<p>You are not logged in, please register or log in.</p>
{% endif %}

<script>
  function searchGroups(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    const formProps = Object.fromEntries(formData);
    console.log(formProps);
    const req = new XMLHttpRequest();
    req.onreadystatechange = function () {
      if (req.readyState === 4) {
        console.log("Got Data");
        html = "";
        // html = '<div class="image-grid container">';
        html = "<h3>Your search results</h3>";

        data = JSON.parse(req.response);
        if (data.length < 1) {
          html += `<p>There were no groups found with group name ${formProps.name}</p>`;
        }
        data.forEach(function (obj) {
          html += `
          
          <div class="card" style="width: 18rem;">
            <div class="card-body">
              <h5 class="card-title">${obj.name}</h5>
              <p class="card-text">${obj.description}</p>
              <a href="/join-group/${obj.name}" class="card-link">Join group</a>
            </div>
          </div>
          
          `;
        });
        // html += "</div>";
        document.getElementById("results").innerHTML = html;
      }
    };
    req.open("GET", `/api/search-groups?groupname=${formProps.groupname}`);
    req.send();
  }
</script>

{% endblock %}