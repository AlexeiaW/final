{% extends "./base.html" %} {% load bootstrap4 %} {% block content %}

<h1>Knowledge Hub</h1>

<a class="nav-link" href="/ask-question/">Ask a question</a>


<h3>Search for questions.</h3>
<form id="search_form" class="form-inline" onsubmit="searchQuestions(event)">
    {% csrf_token %}
    <input class="form-control" type="text" name="search_query" value="" placeholder="Search for questions" size="50" />
    <button class="btn btn-primary" type="submit">Search</button>
</form>

<div id="results" class="list-group">
    {% for question in object_list %}
    <a href="/question/{{question.id}}" class="list-group-item list-group-item-action ">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{question.title}}</h5>
            <small>{{question.created | date}}</small>
        </div>
        <p class="mb-1">{{question.question}}
        </p>
        <small>{{question.user}}</small>
    </a> {% empty %}
    <li>No questions yet.</li>
    {% endfor %}
</div>

<script>
    function searchQuestions(event) {
        event.preventDefault();
        const formData = new FormData(event.target);
        const formProps = Object.fromEntries(formData);
        console.log(formProps);
        const req = new XMLHttpRequest();
        req.onreadystatechange = function () {
            if (req.readyState === 4) {
                console.log("Got Data");
                html = "";
                // html = '<div class="image-grid container">';
                html = "<h3>Your search results</h3>";

                data = JSON.parse(req.response);
                if (data.length < 1) {
                    html += `<p>There were no users found with user name ${formProps.search_query}</p>`;
                }
                data.forEach(function (obj) {
                    html += `
                    <a href="/question/${obj.id}" class="list-group-item list-group-item-action">
                        <div class="d-flex w-100 justify-content-between">
                        <h5 class="mb-1">${obj.title}</h5>
                        <small>${obj.created}</small>
                        </div>
                        <p class="mb-1">${obj.question}</p>
                        <small>${obj.user.user.username}</small>
                    </a>  
            
            `;
                });
                // html += "</div>";
                document.getElementById("results").innerHTML = html;
            }
        };
        req.open("GET", `/api/search-questions?search_query=${formProps.search_query}`);
        req.send();
    }
</script>
{% endblock %}